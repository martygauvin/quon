#summary Developer overview for the Quon system.
#labels Featured,Phase-Implementation

= Introduction =

This page specifies information relevant to a developer looking to understand or enhance the Quon system. It includes an overview of the system architecture, the frameworks and methodologies being used, and steps required to further development of the system.


= Details =

== System Architecture ==

The system follows a typical Model-View-Controller (MVC) architecture, with the model in the {{{app/Model}}} directory, the views in the {{{app/View}}} directory, and the controllers in the {{{app/Controller}}} directory.

== Model Details ==

The system is based on the idea of survey objects, each of which have certain attributes. A survey object can be thought of as a question, branch, or calculation. Survey object attributes specify details such as the question text to display, where to branch based on particular conditions, and what calculations to perform.

Survey objects are collected into survey instances, which specify a particular series of objects that should be run through for that instance. Each instance is a part of a survey that contains information detailing the purpose of the survey and who has access to it.

Surveys can be anonymous (meaning that anybody can start the survey without any authentication), identified (meaning that a username is required to start the survey), auto-identified (meaning that a new username is created when entered for a survey, and the survey then continues as an identified survey), or authenticated (where a username and password is required to take the survey).

Surveys are administered by research users, who are in user groups. Administrator users manage users and groups. Each survey has a creator and belongs to a particular group. Any member of the group can see the survey.

Administrator users are also responsible for system-level configurations.

This section explains the purpose of each component of the model (stored as tables in a relational database).

=== brandings ===

This table defines customised branding css information for surveys.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| name || int(11) || No || None ||
|| css || int(11) || No || None ||
|| survey_id || int(11) || Yes || NULL ||

=== configurations ===

This table defines system-level configuration options using name/value pairs. This includes information such as the name of the institution the installation is a part of, the URL of Mint and export location for ReDBoX, and whether the TinyMCE image manager should be supported.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| name || varchar(50) || No || None ||
|| value || varchar(500) || No || None ||

=== users ===

This table defines researchers and administrators who should be able to log into the system to manage surveys or system settings and users and groups (respectively).

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| type || int(11) || No || None ||
|| username || varchar(50) || No || None ||
|| password || varchar(200) || No || None ||
|| given_name || varchar(50) || No || None ||
|| surname || varchar(50) || No || None ||
|| email || varchar(500) || No || None ||
|| researcher_id || varchar(20) || Yes || NULL ||

=== groups ===

This table defines groups that users can belong to.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None	 ||
|| name || varchar(50) || No || None ||

=== user_groups ===

This table links users to groups.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| user_id || int(11) || No || None ||
|| group_id || int(11)	 || No || None ||

=== surveys ===

This table contains information about surveys created by users. This includes the survey name and type, as well as the user who created the survey, and which group the survey should be accessible for.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| group_id || int(11)	 || No || None ||
|| name || varchar(100) || No || None ||
|| short_name || varchar(20) || No || None ||
|| type || int(11) || No || None ||
|| multiple_run || tinyint(1) || No || None ||
|| user_id || int(11) || No || None	 ||
|| live_instance || int(11) || Yes || NULL ||
|| locked_edit || tinyint(1) || Yes || NULL ||

=== survey_metadatas ===

This table contains information required for export to ReDBoX, such as a description of the survey and access rights for the survey data.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None || 
|| survey_id || int(11) || No || None ||
|| description || text || Yes || NULL ||
|| keywords || text || Yes || NULL ||
|| fields_of_research || varchar(10) || Yes || NULL ||
|| socio-economic_objective || varchar(10) || Yes || NULL ||
|| retention_period || text || Yes || NULL ||
|| access_rights || text || Yes || NULL ||

=== survey_attributes ===

This table contains any survey-level attributes. Used for holding details such as the logo and customised CSS to use for a survey.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| survey_id || int(11) || No || None ||
|| name || varchar(20) || No || None ||
|| value || text || Yes || NULL ||

=== participants ===

This table contains information about participants for various surveys, allowing identification and authentication of participants.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| survey_id || int(11) || No || None ||
|| given_name || varchar(50) || No || None ||
|| surname || varchar(50) || No || None ||
|| dob || date || Yes || NULL ||
|| username || varchar(50) || No || None ||
|| password || varchar(200) || Yes || NULL ||
|| email || varchar(500) || Yes || NULL ||

=== survey_instances ===

This table contains a name for different versions of a survey. It is used to create different versions of the survey, but still be able to determine where results come from.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| survey_id || int(11) || No || None ||
|| name || varchar(50) || No || None ||
|| locked || int(1) || Yes || 0 ||

=== survey_objects ===

This table gives the name and type of each item in the survey (i.e. each question, branch, etc.).

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| survey_id || int(11) || No || None ||
|| name || varchar(50) || No || None ||
|| type || int(11) || No || None ||
|| published || tinyint(1) || No || None ||

=== survey_object_attributes ===

This table gives name/value pairs of attributes for survey objects. This is used, for example, to specify question text, or which options should be available for a particular question.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| survey_object_id || int(11) || No || None ||
|| name || varchar(20) || No || None ||
|| value || text || Yes || NULL ||

=== survey_instance_objects ===

This table specifies which objects belong to a particular survey instance.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| survey_instance_id || int(11) || No || None ||
|| survey_object_id || int(11) || No || None ||
|| order || int(11) || No || None ||

=== survey_results ===

This table specifies which participant has attempted a survey, and when that attempt occurred.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| survey_instance_id || int(11) || No || None ||
|| date || date || No || None ||
|| participant_id || int(11) || No || None ||
|| test || tinyint(1) || No || None ||
|| completed || tinyint(1) || No || None ||
|| time_spent || int(11) || No || None ||
|| pause_count || int(11) || Yes || 0 ||
|| restart_count || int(11) || Yes || 0 ||

=== survey_result_answers ===

This table specifies the actual answers a participant has saved for a survey.

|| *Column* || *Type* || *Null* || *Default* ||
|| id || int(11) || No || None ||
|| survey_result_id || int(11) || No || None ||
|| survey_instance_object_id || int(11) || Yes || NULL ||
|| answer || text || Yes || NULL ||
|| time_spent || int(11) || Yes || NULL ||

== Frameworks and Methodologies ==

Quon is based on the [http://cakephp.org CakePHP framework], and installation essentially follows the [http://book.cakephp.org/2.0/en/installation.html requirements of CakePHP].

QuON supports the commercial ImageManager plugin available from [http://www.tinymce.com]. This plugin allows the uploading of images and other media for insertion into survey pages.

== Adding Extensions ==

The main extension point for QuON is in the {{{app/View/Helper}}} directory, where various {{{QuestionHelper}}}s are defined. By modifying and extending {{{QuestionHelper}}}, new question types can be added to the system.

=== Existing Question Types ===

This section describes the question types currently built into the system. For a more comprehensive overview, please see the user manual.

==== Branch ====

A branch jumps to a different survey object based on a condition. It can specify where to jump when the condition is true, and/or where to jump when the condition is false.

==== ButtonOption ====

A button option displays a series of buttons, and pressing one of the buttons moves to the next question.

Researchers can see the following attributes for button option questions:

http://quon.googlecode.com/svn/wiki/images/ResearcherButtonOption.png

Participants can see the following for button option questions:

http://quon.googlecode.com/svn/wiki/images/UserButtonOption.png

==== Calculation ====

A calculation performs a numeric calculation based on previous answers.

==== Calendar ====

A calendar displays a calendar to allow a participant to select a date.

Researchers can see the following attributes for calendar questions:

http://quon.googlecode.com/svn/wiki/images/ResearcherCalendar.png

Participants can see the following for calendar questions:

http://quon.googlecode.com/svn/wiki/images/UserCalendar.png

==== Checkbox ====

A checkbox displays a series of check boxes, allowing a participant to choose more than one option.

Researchers can see the following attributes for checkbox questions:

http://quon.googlecode.com/svn/wiki/images/ResearcherCheckbox.png

==== Dropdown ====

A dropdown displays a drop-down list of options, allowing a participant to choose one.

==== Informational ====

An informational displays information to a participant, until "next" is selected.

Researchers can see the following attributes for informational questions:

http://quon.googlecode.com/svn/wiki/images/ResearcherInformational.png

==== LikertScale ====

A LikertScale displays a series of Likert items to a participant.

Researchers can see the following attributes for Likert scale questions:

http://quon.googlecode.com/svn/wiki/images/ResearcherLikertScale.png

Participants can see the following for Likert scale questions:

http://quon.googlecode.com/svn/wiki/images/UserLikertScale.png

==== RadioButton ====

A RadioButton display a series of radio buttons to a participant, allowing a single option to be selected.

Researchers can see the following attributes for radio button questions:

http://quon.googlecode.com/svn/wiki/images/ResearcherRadioButton.png

Participants can see the following for radio button questions:

http://quon.googlecode.com/svn/wiki/images/UserRadioButton.png

==== RankOrder ====

A RankOrder allows a participant to rank options in an order.

Researchers can see the following attributes for rank order questions:

http://quon.googlecode.com/svn/wiki/images/ResearcherRankOrder.png

Participants can see the following for rank order questions:

http://quon.googlecode.com/svn/wiki/images/UserRankOrder.png

==== Text ====

A text allows a participant to enter a textual response.

Researchers can see the following attributes for text questions:

http://quon.googlecode.com/svn/wiki/images/ResearcherText.png

=== Adding New Question Types ===

To create a new question type called {{{Foo}}}, the following procedure should be followed (replace {{{Foo}}} with required type otherwise):

1. Edit {{{QuestionHelper}}}, adding a new value to {{{$typeList}}}. e.g.add {{{11 => 'Foo'}}}

2. Create a new file in {{{app/View/Helper}}} called {{{FooQuestionHelper.php}}}

3. Insert the following in {{{FooQuestionHelper.php}}}:
{{{
<?php
App::uses('AppHelper', 'View/Helper');

/**
 * A QuestionHelper that handles questions of type Foo
 */
class FooQuestionHelper extends QuestionHelper {	
	
	protected $attributes = array(0 => array('name' => 'Question Text', 'help' => 'Text to display when asking the user this question', 'type' => 'html')
// any other required attributes. Name is the name of the attribute. Help gives information that will be displayed when a researcher is editing the value. Type specifies whether the TinyMCE editor should be used for editing the attribute.
	);
	
	/**
	 * Specifies how question type Foo should be displayed.
	 * @param $form The form to use
	 * @param $attributes The values of the question attributes to use
	 * @param $previousAnswer The answer to display
	 * @param $show_next whether next should be shown
	 */
	function renderQuestion($form, $attributes, $previousAnswer, &$show_next)
	{	
		echo "Question: ".$attributes[0]."<br/><br/>"
		// TODO: Specify how question should be displayed 
	}

	/**
	 * Converts the given answer to a form storable in the database.
	 * @param $data The data to convert
	 * @param $attributes The value of attributes to use
	 * @return The answer to store in the database
	 */
	function serialiseAnswer($data, $attributes)
	{
		// TODO: Process answer as required
		return $data['Public']['answer'];
	}
	
	/**
	 * Determines if the given answer is valid.
	 * @param $data The data to check
	 * @param $attributes The value of the attributes to use
	 * @param &$error The error to display
	 * @return false if there is an error in the answer, true otherwise
	 */
	function validateAnswer($data, $attributes, &$error)
	{
		// TODO: Enter in validation logic
		return true;
	}
}
?>
}}}

4. Implement methods in {{{FooQuestionHelper.php}}} to ensure the required functionality.